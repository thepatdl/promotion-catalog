<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Shopping Cart with Promo</title>
  <style>
    body {
      font-family: 'Kanit', sans-serif;
      margin: 10px;
    }
    .product-item {
      border: 1px solid #ccc;
      padding: 8px;
      margin-bottom: 12px;
      width: 260px;
      display: inline-block;
      vertical-align: top;
      position: relative;
    }
    .product-item img {
      width: 100%;
      height: auto;
    }
    .product-price {
      font-weight: bold;
      font-size: 16px;
      color: #222;
    }
    .add-btn {
      margin-top: 8px;
      cursor: pointer;
      padding: 6px 12px;
      background: #1976d2;
      color: white;
      border: none;
      border-radius: 4px;
    }
    .cart-popup {
      position: fixed;
      top: 40px;
      right: 20px;
      width: 340px;
      max-height: 70vh;
      overflow-y: auto;
      background: white;
      border: 1px solid #ccc;
      box-shadow: 2px 2px 10px rgba(0,0,0,0.2);
      padding: 12px;
      display: none;
      z-index: 100;
    }
    .cart-item {
      border-bottom: 1px solid #eee;
      padding: 8px 0;
    }
    .cart-total {
      font-weight: bold;
      margin-top: 12px;
    }
    .btn-open-cart {
      position: fixed;
      top: 10px;
      right: 20px;
      padding: 10px 14px;
      background: #1976d2;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      z-index: 101;
    }
  </style>
</head>
<body>

  <h2>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
  <div id="product-list"></div>

  <button class="btn-open-cart" onclick="toggleCart()">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ üõí (<span id="cart-count">0</span>)</button>

  <div class="cart-popup" id="cart-popup">
    <h3>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
    <div id="cart-items"></div>
    <div class="cart-total" id="cart-total"></div>
    <button onclick="sendOrder()" style="margin-top:10px; background:#388e3c; color:#fff; padding:10px; border:none; border-radius:4px; cursor:pointer;">‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
    <button onclick="toggleCart()" style="margin-top:10px; margin-left:10px;">‡∏õ‡∏¥‡∏î</button>
  </div>

<script>
  // ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡∏ô
  const products = [
    {
      id: '8854795000057',
      name: '‡∏™‡∏∏‡∏£‡∏≤‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏á‡∏ä‡∏∏‡∏ô 625ml',
      price: 99,
      promoPrice: 99,
      promoType: null,
      image: 'https://storage.googleapis.com/product-master-image-non-prod/8851111419425.jpg'
    },
    {
      id: '8935040402854',
      name: '100Pipers ‡∏ß‡∏¥‡∏™‡∏Å‡∏µ‡πâ 1000ml',
      price: 1000,
      promoPrice: 835,
      promoType: 'discount',
      image: 'https://storage.googleapis.com/product-master-image-non-prod/8851111419425.jpg'
    },
    {
      id: '8851123794589',
      name: '12PLUS ‡πÅ‡∏õ‡πâ‡∏á‡πÄ‡∏¢‡πá‡∏ô‡πÄ‡∏≠‡πá‡∏Å‡∏ã‡πå‡∏ï‡∏£‡πâ‡∏≤‡∏Ñ‡∏π‡∏•',
      price: 32,
      promoPrice: 32,
      promoType: 'buy1get1',
      image: 'https://storage.googleapis.com/product-master-image-non-prod/8851111419425.jpg'
    },
  ];

  let cart = [];

  const productListEl = document.getElementById('product-list');
  const cartItemsEl = document.getElementById('cart-items');
  const cartTotalEl = document.getElementById('cart-total');
  const cartCountEl = document.getElementById('cart-count');
  const cartPopup = document.getElementById('cart-popup');

  // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
  function renderProducts() {
    productListEl.innerHTML = '';
    products.forEach(p => {
      const div = document.createElement('div');
      div.className = 'product-item';

      let priceHtml = '';
      if (p.promoType === 'discount' && p.promoPrice < p.price) {
        priceHtml = `
          <div style="color:#999; text-decoration: line-through; font-size:12px;">‡∏ø${p.price.toLocaleString()}</div>
          <div class="product-price">‡∏ø${p.promoPrice.toLocaleString()}</div>
        `;
      } else {
        priceHtml = `<div class="product-price">‡∏ø${p.price.toLocaleString()}</div>`;
      }

      const badge = (p.promoType === 'buy1get1') ? 
        `<div style="position:absolute;top:8px;right:8px;background:#e91e63;color:#fff;padding:2px 6px;border-radius:6px;font-size:12px;">1 ‡πÅ‡∏ñ‡∏° 1</div>` : '';

      div.innerHTML = `
        <div style="position:relative;">
          <img src="${p.image}" alt="${p.name}" />
          ${badge}
        </div>
        <div class="product-info">
          <div>${p.name}</div>
          ${priceHtml}
        </div>
        <button class="add-btn" onclick="addToCart('${p.id}')">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
      `;
      productListEl.appendChild(div);
    });
  }

  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
  function addToCart(id) {
    const product = products.find(p => p.id === id);
    if (!product) return;

    const cartItem = cart.find(item => item.id === id);
    if (cartItem) {
      cartItem.quantity++;
    } else {
      cart.push({
        id: product.id,
        name: product.name,
        price: product.price,
        promoPrice: product.promoPrice,
        promoType: product.promoType,
        quantity: 1,
      });
    }
    updateCartUI();
  }

  // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
  function changeCartQuantity(id, delta) {
    const item = cart.find(i => i.id === id);
    if (!item) return;

    item.quantity += delta;
    if (item.quantity <= 0) {
      cart = cart.filter(i => i.id !== id);
    }
    updateCartUI();
  }

  // ‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
  function removeFromCart(id) {
    cart = cart.filter(i => i.id !== id);
    updateCartUI();
  }

  // ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
  function renderCartItems() {
    cartItemsEl.innerHTML = '';
    if (cart.length === 0) {
      cartItemsEl.innerHTML = '<p>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤</p>';
      cartTotalEl.textContent = '';
      return;
    }

    cart.forEach(item => {
      let itemTotalPrice = 0;
      if (item.promoType === 'buy1get1') {
        const payableQty = Math.ceil(item.quantity / 2);
        itemTotalPrice = payableQty * item.price;
      } else if (item.promoType === 'discount') {
        itemTotalPrice = item.promoPrice * item.quantity;
      } else {
        itemTotalPrice = item.price * item.quantity;
      }

      const div = document.createElement('div');
      div.className = 'cart-item';
      div.innerHTML = `
        <div>${item.name}</div>
        <div style="display: flex; align-items: center; gap: 10px; margin-top: 4px;">
          <button onclick="changeCartQuantity('${item.id}', -1)" style="
            background-color: transparent;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 30px;
            height: 30px;
            color: #333;
            cursor: pointer;
          ">‚àí</button>

          <div style="
            width: 40px;
            text-align: center;
            font-weight: bold;
            background-color: #f5f5f5;
            border-radius: 4px;
            padding: 5px 0;
          ">
            ${item.quantity}
          </div>

          <button onclick="changeCartQuantity('${item.id}', 1)" style="
            background-color: transparent;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 30px;
            height: 30px;
            color: #333;
            cursor: pointer;
          ">+</button>

          <span style="margin-left: auto; font-weight: bold;">‡∏ø${itemTotalPrice.toLocaleString()}</span>

          <button onclick="removeFromCart('${item.id}')" style="margin-left:8px; color:#e53935; border:none; background:none; cursor:pointer;">‡∏•‡∏ö</button>
        </div>
      `;
      cartItemsEl.appendChild(div);
    });

    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏ß‡∏°
    let subtotal = 0;
    cart.forEach(item => {
      if (item.promoType === 'buy1get1') {
        const payableQty = Math.ceil(item.quantity / 2);
        subtotal += payableQty * item.price;
      } else if (item.promoType === 'discount') {
        subtotal += item.promoPrice * item.quantity;
      } else {
        subtotal += item.price * item.quantity;
      }
    });

    let shippingFee = 0;
    let total = subtotal;
    if (subtotal < 200 && subtotal > 0) {
      shippingFee = 20;
      total += shippingFee;
      cartTotalEl.innerHTML = `
        <div>‡∏¢‡∏≠‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ‡∏ø${subtotal.toLocaleString()}</div>
        <div>‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á: ‡∏ø${shippingFee.toLocaleString()}</div>
        <div><strong>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ‡∏ø${total.toLocaleString()}</strong></div>
      `;
    } else if (subtotal > 0) {
      cartTotalEl.innerHTML = `
        <div>‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á: ‡∏ü‡∏£‡∏µ</div>
        <div><strong>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ‡∏ø${total.toLocaleString()}</strong></div>
      `;
    } else {
      cartTotalEl.textContent = '';
    }
  }

  // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï UI ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
  function updateCartUI() {
    renderCartItems();
    cartCountEl.textContent = cart.reduce((acc, cur) => acc + cur.quantity, 0);
  }

  // ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
  function toggleCart() {
    if (cartPopup.style.display === 'none' || cartPopup.style.display === '') {
      cartPopup.style.display = 'block';
    } else {
      cartPopup.style.display = 'none';
    }
  }

  // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏ö‡∏ö alert ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°)
  async function sendOrder() {
    if (cart.length === 0) {
      alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á');
      return;
    }

    let message = '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠:\n';
    cart.forEach(item => {
      let itemTotalPrice = 0;
      if (item.promoType === 'buy1get1') {
        const payableQty = Math.ceil(item.quantity / 2);
        itemTotalPrice = payableQty * item.price;
      } else if (item.promoType === 'discount') {
        itemTotalPrice = item.promoPrice * item.quantity;
      } else {
        itemTotalPrice = item.price * item.quantity;
      }
      message += `- ${item.name} x${item.quantity} = ‡∏ø${itemTotalPrice.toLocaleString()}\n`;
    });

    let subtotal = 0;
    cart.forEach(item => {
      if (item.promoType === 'buy1get1') {
        const payableQty = Math.ceil(item.quantity / 2);
        subtotal += payableQty * item.price;
      } else if (item.promoType === 'discount') {
        subtotal += item.promoPrice * item.quantity;
      } else {
        subtotal += item.price * item.quantity;
      }
    });

    let total = subtotal;
    if (subtotal < 200 && subtotal > 0) total += 20;

    message += `‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ‡∏ø${total.toLocaleString()}\n`;
    if (subtotal < 200 && subtotal > 0) message += `‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á: ‡∏ø20\n`;
    else if (subtotal > 0) message += `‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á: ‡∏ü‡∏£‡∏µ\n`;

    alert(message);

    // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á‡∏ú‡πà‡∏≤‡∏ô LINE LIFF ‡∏´‡∏£‡∏∑‡∏≠ API ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÉ‡∏´‡πâ‡∏ô‡∏≥ message ‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ

    // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î popup
    cart = [];
    updateCartUI();
    toggleCart();
  }

  // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
  renderProducts();
  updateCartUI();
</script>

</body>
</html>

