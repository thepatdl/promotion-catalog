<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡πÅ‡∏Ñ‡∏ï‡∏ï‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ CJ</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .product { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; border-radius: 8px; }
    #cartCount { font-weight: bold; color: green; }
    .cart-view { margin-top: 20px; }
    button { margin: 4px; padding: 6px 10px; }
  </style>
</head>
<body onload="initLiff()">

  <h2>üì¶ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <span id="cartCount">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</h2>

  <div id="productList"></div>

  <div class="cart-view">
    <h3>üß∫ ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
    <ul id="cartItems"></ul>
    <p>üí∞ ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <span id="totalPrice">0</span> ‡∏ö‡∏≤‡∏ó</p>
    <button onclick="sendToAdmin()">üì§ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</button>
  </div>

<script>
  const liffId = '2007471898-ElJVq449';
  let cart = [];

  const products = [
    { code: '8851123794589', name: '12PLUS ‡πÅ‡∏õ‡πâ‡∏á‡πÄ‡∏¢‡πá‡∏ô‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π 140g', price: 32 },
    { code: '8851123805414', name: '12PLUS ‡πÅ‡∏õ‡πâ‡∏á‡πÄ‡∏¢‡πá‡∏ô‡πÑ‡∏ß‡∏ó‡πå‡πÄ‡∏ó‡∏ô‡∏ô‡∏¥‡πà‡∏á 140g', price: 32 },
    { code: '8851123782029', name: '12plus ‡πÇ‡∏Ñ‡πÇ‡∏•‡∏ç‡∏°‡πà‡∏ß‡∏á 20ml', price: 35 },
    { code: '8851123389112', name: '12plus ‡πÇ‡∏Ñ‡πÇ‡∏•‡∏ç‡∏ä‡∏°‡∏û‡∏π 45ml', price: 50 },
    { code: '8851123383110', name: '12plus ‡πÇ‡∏£‡∏•‡∏≠‡∏≠‡∏ô‡∏Ñ‡∏≠‡∏•‡∏•‡∏≤‡πÄ‡∏à‡∏ô 32.5ml', price: 49 },
    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
  ];

  function initLiff() {
    liff.init({ liffId }).then(() => {
      if (!liff.isLoggedIn()) liff.login();
      renderProducts();
    });
  }

  function renderProducts() {
    const list = document.getElementById('productList');
    list.innerHTML = '';
    products.forEach((p, i) => {
      const el = document.createElement('div');
      el.className = 'product';
      el.innerHTML = `
        <p><strong>${p.name}</strong></p>
        <p>‡∏£‡∏≤‡∏Ñ‡∏≤: ‡∏ø${p.price}</p>
        <button onclick="addToCart(${i})">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
      `;
      list.appendChild(el);
    });
  }

  function addToCart(index) {
    const product = products[index];
    const existing = cart.find(item => item.code === product.code);
    if (existing) {
      existing.quantity++;
    } else {
      cart.push({ ...product, quantity: 1 });
    }
    updateCartUI();
  }

  function removeFromCart(index) {
    cart.splice(index, 1);
    updateCartUI();
  }

  function updateCartUI() {
    const list = document.getElementById('cartItems');
    list.innerHTML = '';
    let total = 0;

    cart.forEach((item, i) => {
      total += item.price * item.quantity;
      const li = document.createElement('li');
      li.innerHTML = `${item.name} (${item.quantity} ‡∏ä‡∏¥‡πâ‡∏ô) = ‡∏ø${item.price * item.quantity}
        <button onclick="removeFromCart(${i})">‚ùå</button>`;
      list.appendChild(li);
    });

    document.getElementById('cartCount').innerText = cart.length;
    document.getElementById('totalPrice').innerText = total;
  }

  async function sendToAdmin() {
    if (cart.length === 0) {
      alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤");
      return;
    }

    const payload = cart.map(item =>
      `${item.name} (${item.quantity} ‡∏ä‡∏¥‡πâ‡∏ô) = ‡∏ø${item.price * item.quantity}`
    ).join('\n');
    const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
    const message = `üõí ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤:\n${payload}\n\nüí∞ ‡∏£‡∏ß‡∏°: ‡∏ø${total}`;

    try {
      await liff.sendMessages([{ type: 'text', text: message }]);
      alert("üì§ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!");
    } catch (err) {
      console.error(err);
      alert("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠");
    }
  }
</script>
</body>
</html>
